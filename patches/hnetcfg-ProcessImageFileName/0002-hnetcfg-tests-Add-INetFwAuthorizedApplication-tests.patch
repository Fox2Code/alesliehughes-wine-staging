From baad8dbd77ee40d0be7392477d47b63cc4ba0fb7 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 29 Nov 2016 15:44:19 +1100
Subject: [PATCH] hnetcfg/tests: Add INetFwAuthorizedApplication tests

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/hnetcfg/tests/Makefile.in |  2 +-
 dlls/hnetcfg/tests/policy.c    | 32 +++++++++++++++++++++++++++++++-
 2 files changed, 32 insertions(+), 2 deletions(-)

diff --git a/dlls/hnetcfg/tests/Makefile.in b/dlls/hnetcfg/tests/Makefile.in
index aa4062a..5e1ce91 100644
--- a/dlls/hnetcfg/tests/Makefile.in
+++ b/dlls/hnetcfg/tests/Makefile.in
@@ -1,5 +1,5 @@
 TESTDLL   = hnetcfg.dll
-IMPORTS   = ole32 uuid
+IMPORTS   = ole32 uuid oleaut32
 
 C_SRCS = \
 	policy.c
diff --git a/dlls/hnetcfg/tests/policy.c b/dlls/hnetcfg/tests/policy.c
index a3ed4b2..311146f 100644
--- a/dlls/hnetcfg/tests/policy.c
+++ b/dlls/hnetcfg/tests/policy.c
@@ -65,6 +65,36 @@ static void test_interfaces(void)
     INetFwMgr_Release(manager);
 }
 
+static void test_NetFwAuthorizedApplication(void)
+{
+    INetFwAuthorizedApplication *app;
+    HRESULT hr;
+
+    hr = CoCreateInstance(&CLSID_NetFwAuthorizedApplication, NULL, CLSCTX_INPROC_SERVER|CLSCTX_INPROC_HANDLER,
+            &IID_INetFwAuthorizedApplication, (void**)&app);
+    ok(hr == S_OK, "got: %08x\n", hr);
+    if(hr == S_OK)
+    {
+        static WCHAR empty[] = {0};
+        BSTR bstr;
+
+        hr = INetFwAuthorizedApplication_get_ProcessImageFileName(app, NULL);
+        todo_wine ok(hr == E_POINTER, "got: %08x\n", hr);
+
+        hr = INetFwAuthorizedApplication_get_ProcessImageFileName(app, &bstr);
+        todo_wine ok(hr == E_INVALIDARG || hr == S_OK, "got: %08x\n", hr);
+        todo_wine ok(!bstr, "got: %s\n",  wine_dbgstr_w(bstr));
+
+        hr = INetFwAuthorizedApplication_put_ProcessImageFileName(app, NULL);
+        todo_wine ok(hr == E_POINTER || hr == E_INVALIDARG, "got: %08x\n", hr);
+
+        hr = INetFwAuthorizedApplication_put_ProcessImageFileName(app, empty);
+        todo_wine ok(hr == HRESULT_FROM_WIN32(ERROR_PATH_NOT_FOUND), "got: %08x\n", hr);
+
+        INetFwAuthorizedApplication_Release(app);
+    }
+}
+
 START_TEST(policy)
 {
     INetFwMgr *manager;
@@ -84,7 +114,7 @@ START_TEST(policy)
     INetFwMgr_Release(manager);
 
     test_interfaces();
-
+    test_NetFwAuthorizedApplication();
 
     CoUninitialize();
 }
-- 
1.9.1

