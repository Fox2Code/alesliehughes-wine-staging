From aaea194cb1cefcc780870519a6ffc60fa2cf6295 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Fri, 21 Dec 2018 10:19:46 +1100
Subject: [PATCH] mfplat: Implement IMFAttributes Get/Set UINT64

TODO: Add some tests.
---
 dlls/mfplat/main.c | 28 ++++++++++++++++++++++++----
 1 file changed, 24 insertions(+), 4 deletions(-)

diff --git a/dlls/mfplat/main.c b/dlls/mfplat/main.c
index b36d64f..d8461b0 100644
--- a/dlls/mfplat/main.c
+++ b/dlls/mfplat/main.c
@@ -641,10 +641,15 @@ static HRESULT WINAPI mfattributes_GetUINT32(IMFAttributes *iface, REFGUID key,
 static HRESULT WINAPI mfattributes_GetUINT64(IMFAttributes *iface, REFGUID key, UINT64 *value)
 {
     mfattributes *This = impl_from_IMFAttributes(iface);
+    struct attribute *entry;
 
-    FIXME("%p, %s, %p\n", This, debugstr_guid(key), value);
+    TRACE("%p, %s, %p\n", This, debugstr_guid(key), value);
 
-    return E_NOTIMPL;
+    entry = find_attribute_entry(This, key);
+    if(entry)
+        return PropVariantToUInt64(&entry->var, value);
+
+    return MF_E_ATTRIBUTENOTFOUND;
 }
 
 static HRESULT WINAPI mfattributes_GetDouble(IMFAttributes *iface, REFGUID key, double *value)
@@ -785,10 +790,25 @@ static HRESULT WINAPI mfattributes_SetUINT32(IMFAttributes *iface, REFGUID key,
 static HRESULT WINAPI mfattributes_SetUINT64(IMFAttributes *iface, REFGUID key, UINT64 value)
 {
     mfattributes *This = impl_from_IMFAttributes(iface);
+    struct attribute *entry;
 
-    FIXME("%p, %s, %s\n", This, debugstr_guid(key), wine_dbgstr_longlong(value));
+    TRACE("%p, %s, %s\n", This, debugstr_guid(key), wine_dbgstr_longlong(value));
 
-    return E_NOTIMPL;
+    entry = find_attribute_entry(This, key);
+    if(entry)
+    {
+        entry->var.hVal.QuadPart = value;
+        return S_OK;
+    }
+
+    entry = create_attribute_entry(This, key);
+    if(!entry)
+        return E_OUTOFMEMORY;
+
+    entry->var.vt = VT_UI8;
+    entry->var.hVal.QuadPart = value;
+
+    return S_OK;
 }
 
 static HRESULT WINAPI mfattributes_SetDouble(IMFAttributes *iface, REFGUID key, double value)
-- 
1.9.1

