From f7c9b26e5584d7a69a2ec887618e83dcf99fc0ac Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Mon, 28 Nov 2016 09:13:35 +1100
Subject: [PATCH 3/4] d3d10_1: Check parameter in ID3D10Device1
 CreateShaderResourceView1

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/d3d10_1/tests/d3d10_1.c | 3 +++
 dlls/d3d11/device.c          | 3 +++
 2 files changed, 6 insertions(+)

diff --git a/dlls/d3d10_1/tests/d3d10_1.c b/dlls/d3d10_1/tests/d3d10_1.c
index 6007a3b..e1d6d4c 100644
--- a/dlls/d3d10_1/tests/d3d10_1.c
+++ b/dlls/d3d10_1/tests/d3d10_1.c
@@ -371,6 +371,9 @@ static void test_create_shader_resource_view(void)
     U(srv_desc).Buffer.ElementOffset = 0;
     U(srv_desc).Buffer.ElementWidth = 64;
 
+    hr = ID3D10Device1_CreateShaderResourceView1(device, NULL, &srv_desc, &srview);
+    ok(hr == E_INVALIDARG, "Got unexpected hr %#x.\n", hr);
+
     expected_refcount = get_refcount((IUnknown *)device) + 1;
     hr = ID3D10Device1_CreateShaderResourceView1(device, (ID3D10Resource *)buffer, &srv_desc, &srview);
     ok(SUCCEEDED(hr), "Failed to create a shader resource view, hr %#x\n", hr);
diff --git a/dlls/d3d11/device.c b/dlls/d3d11/device.c
index 19c55ff..178b184 100644
--- a/dlls/d3d11/device.c
+++ b/dlls/d3d11/device.c
@@ -4551,6 +4551,9 @@ static HRESULT STDMETHODCALLTYPE d3d10_device_CreateShaderResourceView1(ID3D10De
 
     TRACE("iface %p, resource %p, desc %p, view %p.\n", iface, resource, desc, view);
 
+    if (!resource)
+        return E_INVALIDARG;
+
     if (FAILED(hr = ID3D10Resource_QueryInterface(resource, &IID_ID3D11Resource, (void **)&d3d11_resource)))
     {
         ERR("Resource does not implement ID3D11Resource.\n");
-- 
1.9.1

