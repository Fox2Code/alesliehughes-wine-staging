From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Subject: [v3 PATCH 3/3] mplat/test: Added MFCreateMediaType test
Message-Id: <MEXPR01MB0198F29992BCDAF082F4BD6D93F10@MEXPR01MB0198.ausprd01.prod.outlook.com>
Date: Wed, 31 May 2017 04:38:19 +0000
In-Reply-To: <20170531043740.24485-1-leslie_alistair@hotmail.com>
References: <20170531043740.24485-1-leslie_alistair@hotmail.com>

v2,v3 - No Changes

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/mfplat/tests/mfplat.c | 28 ++++++++++++++++++++++++++++
 1 file changed, 28 insertions(+)

diff --git a/dlls/mfplat/tests/mfplat.c b/dlls/mfplat/tests/mfplat.c
index 83e1538686..bd81ae5d39 100644
--- a/dlls/mfplat/tests/mfplat.c
+++ b/dlls/mfplat/tests/mfplat.c
@@ -191,6 +191,33 @@ static void init_functions(void)
 #undef X
 }
 
+void test_MFCreateMediaType(void)
+{
+    HRESULT hr;
+    IMFMediaType *mediatype;
+
+    hr = MFStartup(MF_VERSION, MFSTARTUP_FULL);
+    todo_wine ok(hr == S_OK, "got 0x%08x\n", hr);
+
+if(0)
+{
+    /* Crash on Windows Vista/7 */
+    hr = MFCreateMediaType(NULL);
+    ok(hr == E_INVALIDARG, "got 0x%08x\n", hr);
+}
+
+    hr = MFCreateMediaType(&mediatype);
+    ok(hr == S_OK, "got 0x%08x\n", hr);
+
+    hr = IMFMediaType_SetGUID(mediatype, &MF_MT_MAJOR_TYPE, &MFMediaType_Video);
+    todo_wine ok(hr == S_OK, "got 0x%08x\n", hr);
+
+    IMFMediaType_Release(mediatype);
+
+    MFShutdown();
+}
+
+
 START_TEST(mfplat)
 {
     CoInitialize(NULL);
@@ -199,6 +226,7 @@ START_TEST(mfplat)
 
     test_register();
     test_source_resolver();
+    test_MFCreateMediaType();
 
     CoUninitialize();
 }

-- 
2.11.0

