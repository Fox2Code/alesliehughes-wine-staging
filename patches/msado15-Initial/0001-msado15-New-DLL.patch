From 930d29b6c56fa417450c3f95b1e9d4a3651befe4 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Fri, 7 Oct 2016 09:13:06 +1100
Subject: [PATCH 01/12] msado15: New DLL

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 configure                 |  2 ++
 configure.ac              |  1 +
 dlls/msado15/Makefile.in  |  4 +++
 dlls/msado15/msado15.c    | 71 +++++++++++++++++++++++++++++++++++++++++++++++
 dlls/msado15/msado15.spec | 18 ++++++++++++
 loader/wine.inf.in        |  1 +
 6 files changed, 97 insertions(+)
 create mode 100644 dlls/msado15/Makefile.in
 create mode 100644 dlls/msado15/msado15.c
 create mode 100644 dlls/msado15/msado15.spec

diff --git a/configure b/configure
index e3181e0..4deb3d7 100755
--- a/configure
+++ b/configure
@@ -1230,6 +1230,7 @@ enable_mpr
 enable_mprapi
 enable_msacm32_drv
 enable_msacm32
+enable_msado15
 enable_msadp32_acm
 enable_msasn1
 enable_mscat32
@@ -18019,6 +18020,7 @@ wine_fn_config_dll msacm.dll16 enable_win16
 wine_fn_config_dll msacm32.drv enable_msacm32_drv
 wine_fn_config_dll msacm32 enable_msacm32 clean,implib
 wine_fn_config_test dlls/msacm32/tests msacm32_test
+wine_fn_config_dll msado15 enable_msado15
 wine_fn_config_dll msadp32.acm enable_msadp32_acm
 wine_fn_config_dll msasn1 enable_msasn1 implib
 wine_fn_config_dll mscat32 enable_mscat32
diff --git a/configure.ac b/configure.ac
index 741a4ef..ca1638e 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3109,6 +3109,7 @@ WINE_CONFIG_DLL(msacm.dll16,enable_win16)
 WINE_CONFIG_DLL(msacm32.drv)
 WINE_CONFIG_DLL(msacm32,,[clean,implib])
 WINE_CONFIG_TEST(dlls/msacm32/tests)
+WINE_CONFIG_DLL(msado15)
 WINE_CONFIG_DLL(msadp32.acm)
 WINE_CONFIG_DLL(msasn1,,[implib])
 WINE_CONFIG_DLL(mscat32)
diff --git a/dlls/msado15/Makefile.in b/dlls/msado15/Makefile.in
new file mode 100644
index 0000000..888be9a
--- /dev/null
+++ b/dlls/msado15/Makefile.in
@@ -0,0 +1,4 @@
+MODULE    = msado15.dll
+
+
+C_SRCS = msado15.c
diff --git a/dlls/msado15/msado15.c b/dlls/msado15/msado15.c
new file mode 100644
index 0000000..b98a78c
--- /dev/null
+++ b/dlls/msado15/msado15.c
@@ -0,0 +1,71 @@
+/*
+ * Copyright 2015 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#include "config.h"
+
+#include <stdarg.h>
+
+#include "windef.h"
+#include "winbase.h"
+#include "ole2.h"
+#include "rpcproxy.h"
+#include "wine/debug.h"
+
+WINE_DEFAULT_DEBUG_CHANNEL(msado);
+
+static HINSTANCE instance;
+
+BOOL WINAPI DllMain(HINSTANCE hinstance, DWORD reason, void *reserved)
+{
+    TRACE("(%p, %u, %p)\n", instance, reason, reserved);
+
+    switch (reason)
+    {
+        case DLL_WINE_PREATTACH:
+            return FALSE;    /* prefer native version */
+        case DLL_PROCESS_ATTACH:
+            instance = hinstance;
+            DisableThreadLibraryCalls(instance);
+            break;
+    }
+
+    return TRUE;
+}
+
+HRESULT WINAPI DllGetClassObject(REFCLSID rclsid, REFIID iid, LPVOID *ppv)
+{
+    FIXME("%s %s %p\n", debugstr_guid(rclsid), debugstr_guid(iid), ppv);
+
+    return CLASS_E_CLASSNOTAVAILABLE;
+}
+
+HRESULT WINAPI DllCanUnloadNow(void)
+{
+    return S_FALSE;
+}
+
+HRESULT WINAPI DllRegisterServer(void)
+{
+    return __wine_register_resources(instance);
+}
+
+
+HRESULT WINAPI DllUnregisterServer(void)
+{
+    return __wine_unregister_resources(instance);
+}
\ No newline at end of file
diff --git a/dlls/msado15/msado15.spec b/dlls/msado15/msado15.spec
new file mode 100644
index 0000000..d7da6e7
--- /dev/null
+++ b/dlls/msado15/msado15.spec
@@ -0,0 +1,18 @@
+@ stub com_ms_wfc_data_Field_getBoolean
+@ stub com_ms_wfc_data_Field_getByte
+@ stub com_ms_wfc_data_Field_getBytes
+@ stub com_ms_wfc_data_Field_getDataTimestamp
+@ stub com_ms_wfc_data_Field_getDouble
+@ stub com_ms_wfc_data_Field_getFloat
+@ stub com_ms_wfc_data_Field_getInt
+@ stub com_ms_wfc_data_Field_getLong
+@ stub com_ms_wfc_data_Field_getShort
+@ stub com_ms_wfc_data_Field_getString
+@ stub com_ms_wfc_data_Field_isNull
+@ stub com_ms_wfc_data_Field_loadMsjava
+@ stub com_ms_wfc_data_Field_setDataDate
+@ stdcall -private DllCanUnloadNow()
+@ stdcall -private DllGetClassObject(ptr ptr ptr)
+@ stdcall -private DllRegisterServer()
+@ stdcall -private DllUnregisterServer()
+@ stub RNIGetCompatibleVersion
\ No newline at end of file
diff --git a/loader/wine.inf.in b/loader/wine.inf.in
index a92a9fe..8f40fb9 100644
--- a/loader/wine.inf.in
+++ b/loader/wine.inf.in
@@ -2603,6 +2603,7 @@ HKLM,%CurrentVersion%\Telephony\Country List\998,"SameAreaRule",,"G"
 16427,Microsoft Shared\TextConv,
 16427,System\OLE DB,oledb32.dll
 16427,System\OLE DB,msdaps.dll
+16427,System\ado,msado15.dll
 11,,*
 
 [SystemIni]
-- 
1.9.1

