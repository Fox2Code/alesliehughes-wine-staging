From 8b7c129cdeace0aeaaa17dcc13881944237483c6 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 3 Sep 2019 09:49:10 +1000
Subject: [PATCH 20/21] dsdmo: Implemnet IDirectSoundFXI3DL2Reverb
 GetAllParameters

---
 dlls/dsdmo/reverb2.c        | 25 ++++++++++++++++++++++---
 dlls/dsound/tests/dsound8.c |  2 +-
 2 files changed, 23 insertions(+), 4 deletions(-)

diff --git a/dlls/dsdmo/reverb2.c b/dlls/dsdmo/reverb2.c
index 0d99da461b..9b318a4a4c 100644
--- a/dlls/dsdmo/reverb2.c
+++ b/dlls/dsdmo/reverb2.c
@@ -34,6 +34,8 @@ struct dmo_reverb2fx
     IMediaObject        IMediaObject_iface;
     IMediaObjectInPlace IMediaObjectInPlace_iface;
     LONG ref;
+
+    DSFXI3DL2Reverb params;
 };
 
 static inline struct dmo_reverb2fx *impl_from_IDirectSoundFXI3DL2Reverb(IDirectSoundFXI3DL2Reverb *iface)
@@ -358,10 +360,16 @@ static HRESULT WINAPI reverb2_SetAllParameters(IDirectSoundFXI3DL2Reverb *iface,
 
 static HRESULT WINAPI reverb2_GetAllParameters(IDirectSoundFXI3DL2Reverb *iface, DSFXI3DL2Reverb *reverb)
 {
-    struct dmo_reverb2fx *This = impl_from_IDirectSoundFXI3DL2Reverb(iface);
-    FIXME("(%p) %p\n", This, reverb);
+     struct dmo_reverb2fx *This = impl_from_IDirectSoundFXI3DL2Reverb(iface);
 
-    return E_NOTIMPL;
+    TRACE("(%p) %p\n", This, reverb);
+
+    if(!reverb)
+        return E_INVALIDARG;
+
+    *reverb = This->params;
+
+    return S_OK;
 }
 
 static HRESULT WINAPI reverb2_SetPreset(IDirectSoundFXI3DL2Reverb *iface, DWORD preset)
@@ -430,5 +438,16 @@ HRESULT WINAPI I3DL2Reverb_CreateInstance(IClassFactory *iface, IUnknown *outer,
     ret = reverb2_QueryInterface(&object->IDirectSoundFXI3DL2Reverb_iface, riid, ppv);
     reverb2_Release(&object->IDirectSoundFXI3DL2Reverb_iface);
 
+    object->params.lRoom          =  -1000;
+    object->params.flRoomRolloffFactor = 0.0f;
+    object->params.flDecayTime    =      1.49f;
+    object->params.flDecayHFRatio =      0.83f;
+    object->params.lReflections   =  -2602;
+    object->params.lReverb        =    200;
+    object->params.flReverbDelay  =      0.011f;
+    object->params.flDiffusion    =    100.0f;
+    object->params.flDensity      =    100.0f;
+    object->params.flHFReference  =   5000.0f;
+
     return ret;
 }
diff --git a/dlls/dsound/tests/dsound8.c b/dlls/dsound/tests/dsound8.c
index 970d07d229..f726bf57b9 100644
--- a/dlls/dsound/tests/dsound8.c
+++ b/dlls/dsound/tests/dsound8.c
@@ -1568,7 +1568,7 @@ static void test_reverb_parameters(LPDIRECTSOUNDBUFFER8 secondary8)
         DSFXI3DL2Reverb params;
 
         rc = IDirectSoundFXI3DL2Reverb_GetAllParameters(reverb, &params);
-        todo_wine ok(rc==DS_OK,"Failed: %08x\n", rc);
+        ok(rc==DS_OK,"Failed: %08x\n", rc);
         if (rc==DS_OK)
         {
             ok(params.lRoom == -1000, "got %d\n", params.lRoom);
-- 
2.17.1

