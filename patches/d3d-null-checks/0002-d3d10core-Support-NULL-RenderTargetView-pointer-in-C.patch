From 952d7dfe3e0c4ba2ea0c298d0c81a9f33d79f160 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 12 Apr 2016 14:23:57 +1000
Subject: [v3 PATCH 2/2] d3d10core: Support NULL RenderTargetView pointer in
 ClearRenderTargetView

no change.

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/d3d10core/tests/device.c | 9 +++++++++
 dlls/d3d11/device.c           | 3 +++
 2 files changed, 12 insertions(+)

diff --git a/dlls/d3d10core/tests/device.c b/dlls/d3d10core/tests/device.c
index 57f013c..70b3b77 100644
--- a/dlls/d3d10core/tests/device.c
+++ b/dlls/d3d10core/tests/device.c
@@ -6079,6 +6079,7 @@ static void test_clear_render_target_view(void)
 {
     static const DWORD expected_color = 0xbf4c7f19, expected_srgb_color = 0xbf95bc59;
     static const float color[] = {0.1f, 0.5f, 0.3f, 0.75f};
+    static const float green[] = {0.0f, 1.0f, 0.0f, 0.5f};
 
     struct d3d10core_test_context test_context;
     ID3D10Texture2D *texture, *srgb_texture;
@@ -6123,6 +6124,14 @@ static void test_clear_render_target_view(void)
     ID3D10Device_ClearRenderTargetView(device, rtv, color);
     check_texture_color(texture, expected_color, 1);
 
+    if(d3d11_available)
+    {
+        ID3D10Device_ClearRenderTargetView(device, NULL, green);
+        check_texture_color(texture, expected_color, 1);
+    }
+    else
+        win_skip("D3D11 is not available, skipping test.\n");
+
     ID3D10Device_ClearRenderTargetView(device, srgb_rtv, color);
     check_texture_color(srgb_texture, expected_srgb_color, 1);
 
diff --git a/dlls/d3d11/device.c b/dlls/d3d11/device.c
index 4a83882..fd88ac1 100644
--- a/dlls/d3d11/device.c
+++ b/dlls/d3d11/device.c
@@ -3445,6 +3445,9 @@ static void STDMETHODCALLTYPE d3d10_device_ClearRenderTargetView(ID3D10Device1 *
     TRACE("iface %p, render_target_view %p, color_rgba %s.\n",
             iface, render_target_view, debug_float4(color_rgba));
 
+    if (!view)
+        return;
+
     wined3d_mutex_lock();
     if (FAILED(hr = wined3d_device_clear_rendertarget_view(device->wined3d_device, view->wined3d_view, NULL,
             WINED3DCLEAR_TARGET, &color, 0.0f, 0)))
-- 
1.9.1

