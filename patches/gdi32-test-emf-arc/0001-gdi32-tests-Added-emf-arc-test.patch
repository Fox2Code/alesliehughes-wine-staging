From aa05f3ac0bb7a578afe071c82e982dbd1c35b4d5 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Tue, 28 Jun 2016 13:56:11 +1000
Subject: [PATCH] gdi32/tests: Added emf arc test

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/gdi32/tests/metafile.c | 65 +++++++++++++++++++++++++++++++++++++++++++++
 1 file changed, 65 insertions(+)

diff --git a/dlls/gdi32/tests/metafile.c b/dlls/gdi32/tests/metafile.c
index 514e2b4..f5bf26f 100644
--- a/dlls/gdi32/tests/metafile.c
+++ b/dlls/gdi32/tests/metafile.c
@@ -1508,6 +1508,36 @@ static const unsigned char EMF_GRADIENTFILL_BITS[] =
     0x14, 0x00, 0x00, 0x00
 };
 
+static const unsigned char EMF_ARC_BITS[] =
+{
+    0x01, 0x00, 0x00, 0x00, 0x6c, 0x00, 0x00, 0x00,
+    0x56, 0x01, 0x00, 0x00, 0x08, 0x01, 0x00, 0x00,
+    0xb9, 0x01, 0x00, 0x00, 0x3a, 0x01, 0x00, 0x00,
+    0x59, 0x23, 0x00, 0x00, 0x52, 0x1b, 0x00, 0x00,
+    0x94, 0x2d, 0x00, 0x00, 0x7f, 0x20, 0x00, 0x00,
+    0x20, 0x45, 0x4d, 0x46, 0x00, 0x00, 0x01, 0x00,
+    0xd0, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,
+    0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x80, 0x07, 0x00, 0x00, 0xec, 0x03, 0x00, 0x00,
+    0xfc, 0x01, 0x00, 0x00, 0x0a, 0x01, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x00, 0x00, 0x00, 0x00, 0x60, 0xc0, 0x07, 0x00,
+    0xa9, 0x0d, 0x04, 0x00, 0x11, 0x00, 0x00, 0x00,
+    0x0c, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00,
+    0x0b, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00,
+    0x01, 0x00, 0x00, 0x00, 0xff, 0xff, 0xff, 0xff,
+    0x39, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x00, 0x00,
+    0x02, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00,
+    0x28, 0x00, 0x00, 0x00, 0x56, 0x01, 0x00, 0x00,
+    0x29, 0xff, 0xff, 0xff, 0xb9, 0x01, 0x00, 0x00,
+    0xc6, 0xfe, 0xff, 0xff, 0x56, 0x01, 0x00, 0x00,
+    0xf7, 0xfe, 0xff, 0xff, 0xba, 0x01, 0x00, 0x00,
+    0xf7, 0xfe, 0xff, 0xff, 0x0e, 0x00, 0x00, 0x00,
+    0x14, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
+    0x10, 0x00, 0x00, 0x00, 0x14, 0x00, 0x00, 0x00
+};
+
 /* For debugging or dumping the raw metafiles produced by
  * new test functions.
  */
@@ -3899,6 +3929,40 @@ static void test_emf_GradientFill(void)
     DeleteEnhMetaFile( hemf );
 }
 
+static void test_emf_arc(void)
+{
+    HDC mf;
+    HENHMETAFILE hemf;
+    BOOL ret;
+    HDC hdc = GetDC(NULL);
+    SIZE size;
+
+    mf = CreateEnhMetaFileA( GetDC( 0 ), NULL, NULL, NULL );
+    ok( mf != 0, "CreateEnhMetaFileA error %d\n", GetLastError() );
+
+    SetMapMode(mf, MM_ANISOTROPIC);
+    SetViewportExtEx(mf, 1, -1, &size);
+
+    /* A EMR_SETARCDIRECTION record is inserted here. */
+
+    ret = Arc(mf, 342, -215, 442, -315, 342, -265, 442, -265);
+    ok( ret, "Arc failed error %d\n", GetLastError() );
+
+    hemf = CloseEnhMetaFile( mf );
+    ok( hemf != 0, "CloseEnhMetaFile error %d\n", GetLastError() );
+
+    if (compare_emf_bits( hemf, EMF_ARC_BITS, sizeof(EMF_ARC_BITS),
+                          "emf_arc", FALSE ) != 0)
+    {
+        dump_emf_bits( hemf, "emf_arc" );
+        dump_emf_records( hemf, "emf_arc" );
+    }
+
+    DeleteEnhMetaFile( hemf );
+
+    DeleteDC(hdc);
+}
+
 START_TEST(metafile)
 {
     init_function_pointers();
@@ -3915,6 +3979,7 @@ START_TEST(metafile)
     test_emf_paths();
     test_emf_PolyPolyline();
     test_emf_GradientFill();
+    test_emf_arc();
 
     /* For win-format metafiles (mfdrv) */
     test_mf_SaveDC();
-- 
1.9.1

