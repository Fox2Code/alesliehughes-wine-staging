From 27dffb67600630286251aacee4943faba16836d5 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Wed, 27 Jan 2016 15:17:45 +1100
Subject: [PATCH 2/3] gdiplus: Implement GdipSetPenTransform

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/gdiplus/pen.c       | 7 ++-----
 dlls/gdiplus/tests/pen.c | 9 ++++-----
 2 files changed, 6 insertions(+), 10 deletions(-)

diff --git a/dlls/gdiplus/pen.c b/dlls/gdiplus/pen.c
index adac25e..83907ec 100644
--- a/dlls/gdiplus/pen.c
+++ b/dlls/gdiplus/pen.c
@@ -435,17 +435,14 @@ GpStatus WINGDIPAPI GdipResetPenTransform(GpPen *pen)
 
 GpStatus WINGDIPAPI GdipSetPenTransform(GpPen *pen, GpMatrix *matrix)
 {
-    static int calls;
-
     TRACE("(%p,%p)\n", pen, matrix);
 
     if(!pen || !matrix)
         return InvalidParameter;
 
-    if(!(calls++))
-        FIXME("not implemented\n");
+    copy_matrix(matrix, pen->transform);
 
-    return NotImplemented;
+    return Ok;
 }
 
 GpStatus WINGDIPAPI GdipGetPenTransform(GpPen *pen, GpMatrix *matrix)
diff --git a/dlls/gdiplus/tests/pen.c b/dlls/gdiplus/tests/pen.c
index 1e63560..691386a 100644
--- a/dlls/gdiplus/tests/pen.c
+++ b/dlls/gdiplus/tests/pen.c
@@ -394,21 +394,20 @@ static void test_transform(void)
 
     GdipCreateMatrix2(3.0, -2.0, 5.0, 2.0, 6.0, 3.0, &matrix2);
     status = GdipSetPenTransform(pen, matrix2);
-    todo_wine expect(Ok, status);
+    expect(Ok, status);
     GdipDeleteMatrix(matrix2);
 
     status = GdipGetPenTransform(pen, matrix);
     expect(Ok, status);
     status = GdipGetMatrixElements(matrix, values);
     expect(Ok, status);
-todo_wine {
     expectf(3.0,  values[0]);
     expectf(-2.0,  values[1]);
     expectf(5.0,  values[2]);
     expectf(2.0, values[3]);
     expectf(6.0, values[4]);
     expectf(3.0,  values[5]);
-}
+
     status = GdipResetPenTransform(pen);
     todo_wine expect(Ok, status);
 
@@ -416,14 +415,14 @@ todo_wine {
     expect(Ok, status);
     status = GdipGetMatrixElements(matrix, values);
     expect(Ok, status);
-
+todo_wine {
     expectf(1.0, values[0]);
     expectf(0.0, values[1]);
     expectf(0.0, values[2]);
     expectf(1.0, values[3]);
     expectf(0.0, values[4]);
     expectf(0.0, values[5]);
-
+}
     GdipDeletePen(pen);
 
     GdipDeleteMatrix(matrix);
-- 
1.9.1

