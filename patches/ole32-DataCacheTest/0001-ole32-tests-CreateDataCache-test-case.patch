From 1192fa2c00c189b76bd10e6619e53d9c8096c643 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Wed, 17 May 2017 15:00:50 +1000
Subject: [PATCH] ole32/tests: CreateDataCache test case

This crashes wine at present.

Test run.
https://testbot.winehq.org/JobDetails.pl?Key=30998

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/ole32/tests/ole2.c | 7 +++++++
 1 file changed, 7 insertions(+)

diff --git a/dlls/ole32/tests/ole2.c b/dlls/ole32/tests/ole2.c
index b30f63b..16affaa 100644
--- a/dlls/ole32/tests/ole2.c
+++ b/dlls/ole32/tests/ole2.c
@@ -1575,6 +1575,7 @@ static void test_data_cache(void)
     char szSystemDir[MAX_PATH];
     WCHAR wszPath[MAX_PATH];
     static const WCHAR wszShell32[] = {'\\','s','h','e','l','l','3','2','.','d','l','l',0};
+    DWORD connection;
 
     static const struct expected_method methods_cacheinitnew[] =
     {
@@ -1659,6 +1660,12 @@ todo_wine {
     IOleCache_Release(olecache);
     IUnknown_Release(unk);
 
+    hr = CreateDataCache(NULL, &CLSID_NULL, &IID_IUnknown, (void**)&olecache);
+    ok(hr == S_OK, "got 0x%08x\n", hr);
+    hr = IOleCache_Cache(olecache, &fmtetc, ADVF_PRIMEFIRST | ADVFCACHE_NOHANDLER, &connection);
+    ok(hr == S_OK, "got 0x%08x\n", hr);
+    IOleCache_Release(olecache);
+
     /* Test with new data */
 
     hr = CreateDataCache(NULL, &CLSID_NULL, &IID_IOleCache2, (LPVOID *)&pOleCache);
-- 
1.9.1

