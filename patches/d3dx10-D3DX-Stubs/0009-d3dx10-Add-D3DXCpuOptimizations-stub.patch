From a3635af0c228f223d6b501e06ed9322fef94d85a Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Fri, 20 Nov 2015 09:38:17 +1100
Subject: [PATCH 9/9] d3dx10: Add D3DXCpuOptimizations stub

Fixes: https://bugs.winehq.org/show_bug.cgi?id=39501

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/d3dx10_43/d3dx10_43.spec   |  2 +-
 dlls/d3dx10_43/d3dx10_43_main.c |  7 +++++++
 include/d3dx10math.h            | 10 ++++++++++
 3 files changed, 18 insertions(+), 1 deletion(-)

diff --git a/dlls/d3dx10_43/d3dx10_43.spec b/dlls/d3dx10_43/d3dx10_43.spec
index 714e69f..9f225c1 100644
--- a/dlls/d3dx10_43/d3dx10_43.spec
+++ b/dlls/d3dx10_43/d3dx10_43.spec
@@ -70,7 +70,7 @@
 @ stdcall D3DXColorAdjustSaturation(ptr ptr float) d3dx9_36.D3DXColorAdjustSaturation
 @ stdcall D3DXComputeBoundingBox(ptr long long ptr ptr) d3dx9_36.D3DXComputeBoundingBox
 @ stdcall D3DXComputeBoundingSphere(ptr long long ptr ptr) d3dx9_36.D3DXComputeBoundingSphere
-@ stub D3DXCpuOptimizations(long)
+@ stdcall D3DXCpuOptimizations(long)
 @ stdcall D3DXCreateMatrixStack(long ptr) d3dx9_36.D3DXCreateMatrixStack
 @ stdcall D3DXFloat16To32Array(ptr ptr long) d3dx9_36.D3DXFloat16To32Array
 @ stdcall D3DXFloat32To16Array(ptr ptr long) d3dx9_36.D3DXFloat32To16Array
diff --git a/dlls/d3dx10_43/d3dx10_43_main.c b/dlls/d3dx10_43/d3dx10_43_main.c
index be0045e..a2bd683 100644
--- a/dlls/d3dx10_43/d3dx10_43_main.c
+++ b/dlls/d3dx10_43/d3dx10_43_main.c
@@ -116,3 +116,10 @@ HRESULT WINAPI D3DX10CreateEffectPoolFromMemory(const void *data, SIZE_T datasiz
 
     return E_NOTIMPL;
 }
+
+D3DX_CPU_OPTIMIZATION WINAPI D3DXCpuOptimizations(BOOL enable)
+{
+    FIXME("enable %d.\n", enable);
+
+    return D3DX_NOT_OPTIMIZED;
+}
diff --git a/include/d3dx10math.h b/include/d3dx10math.h
index 5ef8738..69a282c 100644
--- a/include/d3dx10math.h
+++ b/include/d3dx10math.h
@@ -34,6 +34,15 @@
 #define D3DXToRadian(degree) ((degree) * (D3DX_PI / 180.0f))
 #define D3DXToDegree(radian) ((radian) * (180.0f / D3DX_PI))
 
+typedef enum _D3DX_CPU_OPTIMIZATION
+{
+    D3DX_NOT_OPTIMIZED   = 0,
+    D3DX_3DNOW_OPTIMIZED = 1,
+    D3DX_SSE2_OPTIMIZED  = 2,
+    D3DX_SSE_OPTIMIZED   = 3
+} D3DX_CPU_OPTIMIZATION;
+
+
 /* Copied from d3d9types.h */
 #ifndef D3DVECTOR_DEFINED
 typedef struct _D3DVECTOR {
@@ -426,6 +435,7 @@ FLOAT* WINAPI D3DXSHRotate(FLOAT *out, UINT order, const D3DXMATRIX *matrix, con
 FLOAT* WINAPI D3DXSHRotateZ(FLOAT *out, UINT order, FLOAT angle, const FLOAT *in);
 FLOAT* WINAPI D3DXSHScale(FLOAT *out, UINT order, const FLOAT *a, const FLOAT scale);
 
+D3DX_CPU_OPTIMIZATION WINAPI D3DXCpuOptimizations(BOOL enable);
 #ifdef __cplusplus
 }
 #endif
-- 
1.9.1

