From feb06f3093e6fbe00991e0c2af968885d43a3cc8 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Mon, 26 Oct 2020 14:20:17 +1100
Subject: [PATCH] include: Add IConvertType interface

---
 dlls/msdaps/usrmarshal.c | 15 +++++++++++-
 include/cvttyp.idl       | 50 ++++++++++++++++++++++++++++++++++++++++
 include/oledb.idl        |  1 +
 3 files changed, 65 insertions(+), 1 deletion(-)
 create mode 100644 include/cvttyp.idl

diff --git a/dlls/msdaps/usrmarshal.c b/dlls/msdaps/usrmarshal.c
index 4759d08f1de..c4259bbd3a1 100644
--- a/dlls/msdaps/usrmarshal.c
+++ b/dlls/msdaps/usrmarshal.c
@@ -1615,4 +1615,17 @@ HRESULT __RPC_STUB ICommandProperties_SetProperties_Stub(ICommandProperties* Thi
 {
     FIXME("(%p)->(%d %p %d %p %p): stub\n", This, count, propertyset, total, propstatus, error);
     return E_NOTIMPL;
-}
\ No newline at end of file
+}
+
+HRESULT CALLBACK IConvertType_CanConvert_Proxy(IConvertType* This, DBTYPE from, DBTYPE to, DBCONVERTFLAGS flags)
+{
+    FIXME("(%p)->(%d %d 0x%08x): stub\n", This, from, to, flags);
+    return E_NOTIMPL;
+}
+
+HRESULT __RPC_STUB IConvertType_CanConvert_Stub(IConvertType* This, DBTYPE from, DBTYPE to,
+    DBCONVERTFLAGS flags, IErrorInfo **error)
+{
+    FIXME("(%p)->(%d %d 0x%08x %p): stub\n", This, from, to, flags, error);
+    return E_NOTIMPL;
+}
diff --git a/include/cvttyp.idl b/include/cvttyp.idl
new file mode 100644
index 00000000000..87bc385a5ba
--- /dev/null
+++ b/include/cvttyp.idl
@@ -0,0 +1,50 @@
+/*
+ * Copyright (C) 2020 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#if 0
+#pragma makedep install
+#endif
+
+[
+    object,
+    uuid(0c733a88-2a1c-11ce-ade5-00aa0044773d),
+    pointer_default(unique)
+]
+interface IConvertType : IUnknown
+{
+    typedef DWORD DBCONVERTFLAGS;
+
+    enum DBCONVERTFLAGSENUM
+    {
+        DBCONVERTFLAGS_COLUMN    = 0x000,
+        DBCONVERTFLAGS_PARAMETER = 0x001,
+    };
+
+    enum DBCONVERTFLAGSENUM20
+    {
+        DBCONVERTFLAGS_ISLONG        = 0x002,
+        DBCONVERTFLAGS_ISFIXEDLENGTH = 0x004,
+        DBCONVERTFLAGS_FROMVARIANT   = 0x008,
+    };
+
+    [local]
+    HRESULT CanConvert([in] DBTYPE from, [in] DBTYPE to, [in] DBCONVERTFLAGS flags);
+
+    [call_as(CanConvert)]
+    HRESULT RemoteCanConvert([in] DBTYPE from, [in] DBTYPE to, [in] DBCONVERTFLAGS flags, [out] IErrorInfo **error);
+}
diff --git a/include/oledb.idl b/include/oledb.idl
index 4370c7f6bcc..c56460262f5 100644
--- a/include/oledb.idl
+++ b/include/oledb.idl
@@ -72,6 +72,7 @@ typedef DWORD_PTR DBHASHVALUE;
 #include "getdts.idl"
 #include "cmdstrm.idl"
 #include "cmdprp.idl"
+#include "cvttyp.idl"
 
 cpp_quote("#include <accctrl.h>")
 
-- 
2.28.0

