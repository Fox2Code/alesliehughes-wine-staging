From da39a129dc2185ea342e3ff4e8995a2642e79334 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Wed, 18 Jan 2017 14:53:02 +1100
Subject: [PATCH 1/2] mtxdm: New DLL

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 configure               |  2 ++
 configure.ac            |  1 +
 dlls/mtxdm/Makefile.in  |  5 +++++
 dlls/mtxdm/mtxdm.spec   |  1 +
 dlls/mtxdm/mtxdm_main.c | 43 +++++++++++++++++++++++++++++++++++++++++++
 5 files changed, 52 insertions(+)
 create mode 100644 dlls/mtxdm/Makefile.in
 create mode 100644 dlls/mtxdm/mtxdm.spec
 create mode 100644 dlls/mtxdm/mtxdm_main.c

diff --git a/configure b/configure
index 34a84ca..e17c03a 100755
--- a/configure
+++ b/configure
@@ -1332,6 +1332,7 @@ enable_msxml2
 enable_msxml3
 enable_msxml4
 enable_msxml6
+enable_mtxdm
 enable_ncrypt
 enable_nddeapi
 enable_ndis_sys
@@ -18213,6 +18214,7 @@ wine_fn_config_dll msxml3 enable_msxml3 clean
 wine_fn_config_test dlls/msxml3/tests msxml3_test clean
 wine_fn_config_dll msxml4 enable_msxml4 clean
 wine_fn_config_dll msxml6 enable_msxml6 clean
+wine_fn_config_dll mtxdm enable_mtxdm
 wine_fn_config_dll ncrypt enable_ncrypt
 wine_fn_config_dll nddeapi enable_nddeapi implib
 wine_fn_config_dll ndis.sys enable_ndis_sys
diff --git a/configure.ac b/configure.ac
index fa27a6c..75165ca 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3247,6 +3247,7 @@ WINE_CONFIG_DLL(msxml3,,[clean])
 WINE_CONFIG_TEST(dlls/msxml3/tests,[clean])
 WINE_CONFIG_DLL(msxml4,,[clean])
 WINE_CONFIG_DLL(msxml6,,[clean])
+WINE_CONFIG_DLL(mtxdm)
 WINE_CONFIG_DLL(ncrypt)
 WINE_CONFIG_DLL(nddeapi,,[implib])
 WINE_CONFIG_DLL(ndis.sys)
diff --git a/dlls/mtxdm/Makefile.in b/dlls/mtxdm/Makefile.in
new file mode 100644
index 0000000..074dcfd
--- /dev/null
+++ b/dlls/mtxdm/Makefile.in
@@ -0,0 +1,5 @@
+MODULE    = mtxdm.dll
+
+
+C_SRCS = \
+	mtxdm_main.c
diff --git a/dlls/mtxdm/mtxdm.spec b/dlls/mtxdm/mtxdm.spec
new file mode 100644
index 0000000..9cff0d9
--- /dev/null
+++ b/dlls/mtxdm/mtxdm.spec
@@ -0,0 +1 @@
+@ stub GetDispenserManager
diff --git a/dlls/mtxdm/mtxdm_main.c b/dlls/mtxdm/mtxdm_main.c
new file mode 100644
index 0000000..d859571
--- /dev/null
+++ b/dlls/mtxdm/mtxdm_main.c
@@ -0,0 +1,43 @@
+/*
+ * Copyright (C) 2017 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#include "config.h"
+
+#include <stdarg.h>
+
+#include "windef.h"
+#include "winbase.h"
+#include "wine/debug.h"
+
+WINE_DEFAULT_DEBUG_CHANNEL(comsvcs);
+
+BOOL WINAPI DllMain(HINSTANCE instance, DWORD reason, void *reserved)
+{
+    TRACE("(%p, %u, %p)\n", instance, reason, reserved);
+
+    switch (reason)
+    {
+        case DLL_WINE_PREATTACH:
+            return FALSE;    /* prefer native version */
+        case DLL_PROCESS_ATTACH:
+            DisableThreadLibraryCalls(instance);
+            break;
+    }
+
+    return TRUE;
+}
-- 
1.9.1

