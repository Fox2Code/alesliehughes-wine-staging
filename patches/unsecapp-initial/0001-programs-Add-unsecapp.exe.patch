From 55ec421f5922d5597601ab9f7eab7fd7d6e14394 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Mon, 3 Sep 2018 14:06:08 +1000
Subject: [PATCH 1/4] programs: Add unsecapp.exe

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 configure                     | 16 +++-------------
 configure.ac                  |  1 +
 loader/wine.inf.in            |  2 ++
 programs/unsecapp/Makefile.in |  6 ++++++
 programs/unsecapp/main.c      | 35 +++++++++++++++++++++++++++++++++++
 5 files changed, 47 insertions(+), 13 deletions(-)
 create mode 100644 programs/unsecapp/Makefile.in
 create mode 100644 programs/unsecapp/main.c

diff --git a/configure b/configure
index 5d520f0..22eb789 100755
--- a/configure
+++ b/configure
@@ -805,7 +805,6 @@ infodir
 docdir
 oldincludedir
 includedir
-runstatedir
 localstatedir
 sharedstatedir
 sysconfdir
@@ -1731,6 +1730,7 @@ enable_taskmgr
 enable_termsv
 enable_uninstaller
 enable_unlodctr
+enable_unsecapp
 enable_view
 enable_wevtutil
 enable_wineboot
@@ -1872,7 +1872,6 @@ datadir='${datarootdir}'
 sysconfdir='${prefix}/etc'
 sharedstatedir='${prefix}/com'
 localstatedir='${prefix}/var'
-runstatedir='${localstatedir}/run'
 includedir='${prefix}/include'
 oldincludedir='/usr/include'
 docdir='${datarootdir}/doc/${PACKAGE_TARNAME}'
@@ -2125,15 +2124,6 @@ do
   | -silent | --silent | --silen | --sile | --sil)
     silent=yes ;;
 
-  -runstatedir | --runstatedir | --runstatedi | --runstated \
-  | --runstate | --runstat | --runsta | --runst | --runs \
-  | --run | --ru | --r)
-    ac_prev=runstatedir ;;
-  -runstatedir=* | --runstatedir=* | --runstatedi=* | --runstated=* \
-  | --runstate=* | --runstat=* | --runsta=* | --runst=* | --runs=* \
-  | --run=* | --ru=* | --r=*)
-    runstatedir=$ac_optarg ;;
-
   -sbindir | --sbindir | --sbindi | --sbind | --sbin | --sbi | --sb)
     ac_prev=sbindir ;;
   -sbindir=* | --sbindir=* | --sbindi=* | --sbind=* | --sbin=* \
@@ -2271,7 +2261,7 @@ fi
 for ac_var in	exec_prefix prefix bindir sbindir libexecdir datarootdir \
 		datadir sysconfdir sharedstatedir localstatedir includedir \
 		oldincludedir docdir infodir htmldir dvidir pdfdir psdir \
-		libdir localedir mandir runstatedir
+		libdir localedir mandir
 do
   eval ac_val=\$$ac_var
   # Remove trailing slashes.
@@ -2424,7 +2414,6 @@ Fine tuning of the installation directories:
   --sysconfdir=DIR        read-only single-machine data [PREFIX/etc]
   --sharedstatedir=DIR    modifiable architecture-independent data [PREFIX/com]
   --localstatedir=DIR     modifiable single-machine data [PREFIX/var]
-  --runstatedir=DIR       modifiable per-process data [LOCALSTATEDIR/run]
   --libdir=DIR            object code libraries [EPREFIX/lib]
   --includedir=DIR        C header files [PREFIX/include]
   --oldincludedir=DIR     C header files for non-gcc [/usr/include]
@@ -20088,6 +20077,7 @@ wine_fn_config_makefile programs/taskmgr enable_taskmgr
 wine_fn_config_makefile programs/termsv enable_termsv
 wine_fn_config_makefile programs/uninstaller enable_uninstaller
 wine_fn_config_makefile programs/unlodctr enable_unlodctr
+wine_fn_config_makefile programs/unsecapp enable_unsecapp
 wine_fn_config_makefile programs/view enable_view
 wine_fn_config_makefile programs/wevtutil enable_wevtutil
 wine_fn_config_makefile programs/wineboot enable_wineboot
diff --git a/configure.ac b/configure.ac
index 2b63d6a..89959f4 100644
--- a/configure.ac
+++ b/configure.ac
@@ -3947,6 +3947,7 @@ WINE_CONFIG_MAKEFILE(programs/taskmgr)
 WINE_CONFIG_MAKEFILE(programs/termsv)
 WINE_CONFIG_MAKEFILE(programs/uninstaller)
 WINE_CONFIG_MAKEFILE(programs/unlodctr)
+WINE_CONFIG_MAKEFILE(programs/unsecapp)
 WINE_CONFIG_MAKEFILE(programs/view)
 WINE_CONFIG_MAKEFILE(programs/wevtutil)
 WINE_CONFIG_MAKEFILE(programs/wineboot)
diff --git a/loader/wine.inf.in b/loader/wine.inf.in
index 4f241c0..fae1062 100644
--- a/loader/wine.inf.in
+++ b/loader/wine.inf.in
@@ -2549,6 +2549,7 @@ HKLM,%CurrentVersion%\Telephony\Country List\998,"SameAreaRule",,"G"
 11,gecko\plugin,npmshtml.dll
 11,Speech\Common,sapi.dll
 11,wbem,mofcomp.exe
+11,wbem,unsecapp.exe
 10,syswow64,stdole2.tlb
 11,,iexplore.exe
 11,,winetest.exe,-
@@ -2626,6 +2627,7 @@ HKLM,%CurrentVersion%\Telephony\Country List\998,"SameAreaRule",,"G"
 11,wbem,wbemprox.dll
 11,wbem,wmic.exe
 11,wbem,wmiutils.dll
+11,wbem,unsecapp.exe
 ; empty folders to make sure the parent dirs are not removed
 16410,Microsoft,
 16412,Microsoft,
diff --git a/programs/unsecapp/Makefile.in b/programs/unsecapp/Makefile.in
new file mode 100644
index 0000000..46cda65
--- /dev/null
+++ b/programs/unsecapp/Makefile.in
@@ -0,0 +1,6 @@
+MODULE    = unsecapp.exe
+APPMODE   = -mwindows -municode
+IMPORTS   = ole32
+
+C_SRCS = \
+	main.c
diff --git a/programs/unsecapp/main.c b/programs/unsecapp/main.c
new file mode 100644
index 0000000..a10f685
--- /dev/null
+++ b/programs/unsecapp/main.c
@@ -0,0 +1,35 @@
+/*
+ * Copyright 2018 Alistair Leslie-Hughes
+ *
+ * This library is free software; you can redistribute it and/or
+ * modify it under the terms of the GNU Lesser General Public
+ * License as published by the Free Software Foundation; either
+ * version 2.1 of the License, or (at your option) any later version.
+ *
+ * This library is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
+ * Lesser General Public License for more details.
+ *
+ * You should have received a copy of the GNU Lesser General Public
+ * License along with this library; if not, write to the Free Software
+ * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
+ */
+
+#include <windows.h>
+#include <shellapi.h>
+#include <setupapi.h>
+#include <shlwapi.h>
+#include <shlobj.h>
+
+#include "wine/unicode.h"
+#include "wine/debug.h"
+
+WINE_DEFAULT_DEBUG_CHANNEL(unsecapp);
+
+int PASCAL wWinMain(HINSTANCE hInstance, HINSTANCE prev, LPWSTR cmdline, int show)
+{
+    FIXME("%p, %p, %s, %d\n", hInstance, prev, debugstr_w(cmdline), show);
+   
+    return 0;
+}
-- 
1.9.1

