From 5fa87b724ce2a1017425008a6fdd50a8429b00a5 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Thu, 5 Oct 2017 11:58:10 +1100
Subject: [PATCH 2/3] kernelbase: Add AppPolicyGetProcessTerminationMethod stub

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 .../api-ms-win-appmodel-runtime-l1-1-2.spec               |  2 +-
 dlls/kernelbase/kernelbase.spec                           |  2 +-
 dlls/kernelbase/main.c                                    | 15 +++++++++++++++
 3 files changed, 17 insertions(+), 2 deletions(-)

diff --git a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
index ce38d95..8ae7f0b 100644
--- a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
+++ b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
@@ -2,7 +2,7 @@
 @ stub AppPolicyGetCreateFileAccess
 @ stub AppPolicyGetLifecycleManagement
 @ stub AppPolicyGetMediaFoundationCodecLoading
-@ stub AppPolicyGetProcessTerminationMethod
+@ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr) kernelbase.AppPolicyGetProcessTerminationMethod
 @ stub AppPolicyGetShowDeveloperDiagnostic
 @ stub AppPolicyGetThreadInitializationType
 @ stub AppPolicyGetWindowingModel
diff --git a/dlls/kernelbase/kernelbase.spec b/dlls/kernelbase/kernelbase.spec
index f508c25..e228497 100644
--- a/dlls/kernelbase/kernelbase.spec
+++ b/dlls/kernelbase/kernelbase.spec
@@ -44,7 +44,7 @@
 # @ stub AppPolicyGetCreateFileAccess
 # @ stub AppPolicyGetLifecycleManagement
 # @ stub AppPolicyGetMediaFoundationCodecLoading
-# @ stub AppPolicyGetProcessTerminationMethod
+@ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr)
 # @ stub AppPolicyGetShowDeveloperDiagnostic
 # @ stub AppPolicyGetThreadInitializationType
 # @ stub AppPolicyGetWindowingModel
diff --git a/dlls/kernelbase/main.c b/dlls/kernelbase/main.c
index 30cba3f..f402ec4 100644
--- a/dlls/kernelbase/main.c
+++ b/dlls/kernelbase/main.c
@@ -15,12 +15,27 @@
  * License along with this library; if not, write to the Free Software
  * Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA 02110-1301, USA
  */
+#include "windows.h"
 
 #include "wine/debug.h"
+#include "appmodel.h"
 
 WINE_DEFAULT_DEBUG_CHANNEL(kernelbase);
 
 /***********************************************************************
+ *          AppPolicyGetProcessTerminationMethod (KERNELBASE.@)
+ */
+LONG WINAPI AppPolicyGetProcessTerminationMethod(HANDLE token, AppPolicyProcessTerminationMethod *policy)
+{
+    FIXME("%p, %p\n", token, policy);
+
+    if(policy)
+        *policy = AppPolicyProcessTerminationMethod_ExitProcess;
+
+    return ERROR_SUCCESS;
+}
+
+/***********************************************************************
  *          QuirkIsEnabled3 (KERNELBASE.@)
  */
 BOOL WINAPI QuirkIsEnabled3(void *unk1, void *unk2)
-- 
1.9.1

