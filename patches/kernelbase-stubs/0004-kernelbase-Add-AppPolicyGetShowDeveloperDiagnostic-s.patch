From 7a7a568933d312343d19876b326fd34838972214 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Thu, 5 Oct 2017 15:04:20 +1100
Subject: [PATCH] kernelbase: Add AppPolicyGetShowDeveloperDiagnostic stub

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 .../api-ms-win-appmodel-runtime-l1-1-2.spec                |  2 +-
 dlls/kernelbase/kernelbase.spec                            |  2 +-
 dlls/kernelbase/main.c                                     | 14 ++++++++++++++
 include/appmodel.h                                         |  7 +++++++
 4 files changed, 23 insertions(+), 2 deletions(-)

diff --git a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
index f98ec0e..40f5f53 100644
--- a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
+++ b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
@@ -3,7 +3,7 @@
 @ stub AppPolicyGetLifecycleManagement
 @ stub AppPolicyGetMediaFoundationCodecLoading
 @ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr) kernelbase.AppPolicyGetProcessTerminationMethod
-@ stub AppPolicyGetShowDeveloperDiagnostic
+@ stdcall AppPolicyGetShowDeveloperDiagnostic(ptr ptr) kernelbase.AppPolicyGetShowDeveloperDiagnostic
 @ stdcall AppPolicyGetThreadInitializationType(ptr ptr) kernelbase.AppPolicyGetThreadInitializationType
 @ stub AppPolicyGetWindowingModel
 @ stub GetApplicationUserModelIdFromToken
diff --git a/dlls/kernelbase/kernelbase.spec b/dlls/kernelbase/kernelbase.spec
index 85b2323..17b84da 100644
--- a/dlls/kernelbase/kernelbase.spec
+++ b/dlls/kernelbase/kernelbase.spec
@@ -45,7 +45,7 @@
 # @ stub AppPolicyGetLifecycleManagement
 # @ stub AppPolicyGetMediaFoundationCodecLoading
 @ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr)
-# @ stub AppPolicyGetShowDeveloperDiagnostic
+@ stdcall AppPolicyGetShowDeveloperDiagnostic(ptr ptr)
 @ stdcall AppPolicyGetThreadInitializationType(ptr ptr)
 # @ stub AppPolicyGetWindowingModel
 # @ stub AppXFreeMemory
diff --git a/dlls/kernelbase/main.c b/dlls/kernelbase/main.c
index ea86c39..1efc175 100644
--- a/dlls/kernelbase/main.c
+++ b/dlls/kernelbase/main.c
@@ -49,6 +49,20 @@ LONG WINAPI AppPolicyGetThreadInitializationType(HANDLE token, AppPolicyThreadIn
 }
 
 /***********************************************************************
+ *          AppPolicyGetShowDeveloperDiagnostic (KERNELBASE.@)
+ */
+LONG WINAPI AppPolicyGetShowDeveloperDiagnostic(HANDLE token, AppPolicyShowDeveloperDiagnostic *policy)
+{
+    FIXME("%p, %p\n", token, policy);
+
+    if(policy)
+        *policy = AppPolicyShowDeveloperDiagnostic_None;
+
+    return ERROR_SUCCESS;
+}
+
+
+/***********************************************************************
  *          QuirkIsEnabled3 (KERNELBASE.@)
  */
 BOOL WINAPI QuirkIsEnabled3(void *unk1, void *unk2)
diff --git a/include/appmodel.h b/include/appmodel.h
index bc61a89..58d69a0 100644
--- a/include/appmodel.h
+++ b/include/appmodel.h
@@ -34,7 +34,14 @@ typedef enum AppPolicyThreadInitializationType
     AppPolicyThreadInitializationType_InitializeWinRT = 1,
 } AppPolicyThreadInitializationType;
 
+typedef enum AppPolicyShowDeveloperDiagnostic
+{
+    AppPolicyShowDeveloperDiagnostic_None   = 0,
+    AppPolicyShowDeveloperDiagnostic_ShowUI = 1,
+} AppPolicyShowDeveloperDiagnostic;
+
 LONG WINAPI AppPolicyGetProcessTerminationMethod(HANDLE token, AppPolicyProcessTerminationMethod *policy);
+LONG WINAPI AppPolicyGetShowDeveloperDiagnostic(HANDLE token, AppPolicyShowDeveloperDiagnostic *policy);
 LONG WINAPI AppPolicyGetThreadInitializationType(HANDLE token, AppPolicyThreadInitializationType *policy);
 
 #if defined(__cplusplus)
-- 
1.9.1

