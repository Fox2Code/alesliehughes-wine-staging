From 0d60a37bb399b1be11fd962fa0172e5ada5a5f6c Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Thu, 5 Oct 2017 15:46:16 +1100
Subject: [PATCH] kernelbase: Add AppPolicyGetWindowingModel stub

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 .../api-ms-win-appmodel-runtime-l1-1-2.spec                  |  2 +-
 dlls/kernelbase/kernelbase.spec                              |  2 +-
 dlls/kernelbase/main.c                                       | 12 ++++++++++++
 include/appmodel.h                                           |  9 +++++++++
 4 files changed, 23 insertions(+), 2 deletions(-)

diff --git a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
index 40f5f53..3c1b405 100644
--- a/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
+++ b/dlls/api-ms-win-appmodel-runtime-l1-1-2/api-ms-win-appmodel-runtime-l1-1-2.spec
@@ -5,7 +5,7 @@
 @ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr) kernelbase.AppPolicyGetProcessTerminationMethod
 @ stdcall AppPolicyGetShowDeveloperDiagnostic(ptr ptr) kernelbase.AppPolicyGetShowDeveloperDiagnostic
 @ stdcall AppPolicyGetThreadInitializationType(ptr ptr) kernelbase.AppPolicyGetThreadInitializationType
-@ stub AppPolicyGetWindowingModel
+@ stdcall AppPolicyGetWindowingModel(ptr ptr) kernelbase.AppPolicyGetWindowingModel
 @ stub GetApplicationUserModelIdFromToken
 @ stub GetPackageFamilyNameFromToken
 @ stub GetPackageFullNameFromToken
diff --git a/dlls/kernelbase/kernelbase.spec b/dlls/kernelbase/kernelbase.spec
index 17b84da..395b658 100644
--- a/dlls/kernelbase/kernelbase.spec
+++ b/dlls/kernelbase/kernelbase.spec
@@ -47,7 +47,7 @@
 @ stdcall AppPolicyGetProcessTerminationMethod(ptr ptr)
 @ stdcall AppPolicyGetShowDeveloperDiagnostic(ptr ptr)
 @ stdcall AppPolicyGetThreadInitializationType(ptr ptr)
-# @ stub AppPolicyGetWindowingModel
+@ stdcall AppPolicyGetWindowingModel(ptr ptr)
 # @ stub AppXFreeMemory
 # @ stub AppXGetApplicationData
 # @ stub AppXGetDevelopmentMode
diff --git a/dlls/kernelbase/main.c b/dlls/kernelbase/main.c
index 0f5135f..e92371e 100644
--- a/dlls/kernelbase/main.c
+++ b/dlls/kernelbase/main.c
@@ -61,6 +61,18 @@ LONG WINAPI AppPolicyGetShowDeveloperDiagnostic(HANDLE token, AppPolicyShowDevel
     return ERROR_SUCCESS;
 }
 
+/***********************************************************************
+ *          AppPolicyGetWindowingModel (KERNELBASE.@)
+ */
+LONG WINAPI AppPolicyGetWindowingModel(HANDLE token, AppPolicyWindowingModel *policy)
+{
+    FIXME("%p, %p\n", token, policy);
+
+    if(policy)
+        *policy = AppPolicyWindowingModel_ClassicDesktop;
+
+    return ERROR_SUCCESS;
+}
 
 /***********************************************************************
  *          QuirkIsEnabled3 (KERNELBASE.@)
diff --git a/include/appmodel.h b/include/appmodel.h
index 58d69a0..34da979 100644
--- a/include/appmodel.h
+++ b/include/appmodel.h
@@ -40,9 +40,18 @@ typedef enum AppPolicyShowDeveloperDiagnostic
     AppPolicyShowDeveloperDiagnostic_ShowUI = 1,
 } AppPolicyShowDeveloperDiagnostic;
 
+typedef enum AppPolicyWindowingModel
+{
+    AppPolicyWindowingModel_None           = 0,
+    AppPolicyWindowingModel_Universal      = 1,
+    AppPolicyWindowingModel_ClassicDesktop = 2,
+    AppPolicyWindowingModel_ClassicPhone   = 3
+} AppPolicyWindowingModel;
+
 LONG WINAPI AppPolicyGetProcessTerminationMethod(HANDLE token, AppPolicyProcessTerminationMethod *policy);
 LONG WINAPI AppPolicyGetShowDeveloperDiagnostic(HANDLE token, AppPolicyShowDeveloperDiagnostic *policy);
 LONG WINAPI AppPolicyGetThreadInitializationType(HANDLE token, AppPolicyThreadInitializationType *policy);
+LONG WINAPI AppPolicyGetWindowingModel(HANDLE processToken, AppPolicyWindowingModel *policy);
 
 #if defined(__cplusplus)
 }
-- 
1.9.1

