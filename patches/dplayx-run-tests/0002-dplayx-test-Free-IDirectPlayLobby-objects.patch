From 389fdafedc70b6fd496cc2d7ff45e93dd8ca0563 Mon Sep 17 00:00:00 2001
From: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
Date: Fri, 3 Mar 2017 16:11:59 +1100
Subject: [PATCH 2/2] dplayx/test: Free IDirectPlayLobby objects

Signed-off-by: Alistair Leslie-Hughes <leslie_alistair@hotmail.com>
---
 dlls/dplayx/tests/dplayx.c | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/dlls/dplayx/tests/dplayx.c b/dlls/dplayx/tests/dplayx.c
index 27dc9ee..2b4fda3 100644
--- a/dlls/dplayx/tests/dplayx.c
+++ b/dlls/dplayx/tests/dplayx.c
@@ -700,7 +700,7 @@ static void init_TCPIP_provider( IDirectPlay4 *pDP, LPCSTR strIPAddressString, W
     checkHR( DP_OK, hr );
 
     HeapFree( GetProcessHeap(), 0, pAddress );
-
+    IDirectPlayLobby_Release(pDPL);
 }
 
 static BOOL CALLBACK EnumSessions_cb_join( LPCDPSESSIONDESC2 lpThisSD,
@@ -940,6 +940,8 @@ static BOOL CALLBACK EnumConnections_cb( LPCGUID lpguidSP,
 
     callbackData->dwCounter1++;
 
+    IDirectPlayLobby_Release(pDPL);
+
     return TRUE;
 }
 
@@ -3075,7 +3077,7 @@ static void test_GetPlayerAddress(void)
     if ( hr == DP_OK )
     {
         todo_wine win_skip( "GetPlayerAddress not implemented\n" );
-        return;
+        goto cleanup;
     }
 
     init_TCPIP_provider( pDP[0], "127.0.0.1", 0 );
@@ -3171,9 +3173,11 @@ static void test_GetPlayerAddress(void)
 
 
     HeapFree( GetProcessHeap(), 0, lpData );
+
+cleanup:
     IDirectPlayX_Release( pDP[0] );
     IDirectPlayX_Release( pDP[1] );
-
+    IDirectPlayLobby_Release(pDPL);
 }
 
 /* GetPlayerFlags */
-- 
1.9.1

